{"id":"bucket-04m","title":"Vector type detection for sqlite3 dialect","description":"Implement spec-\u003edb-type and spec-\u003edb-cast multimethods for :sqlite3 to detect vector fields.\n\nA vector field is identified by :type :seq (normalized from [:float]) + :db :type containing 'vec_f32'.\n\nTDD:\n- RED: spec-\u003edb-type returns :sqlite-vec for {:type [:float] :db {:type \"vec_f32(3)\"}}\n- RED: spec-\u003edb-cast returns appropriate cast info for vector fields\n- GREEN: Implement defmethod jdbc/spec-\u003edb-type :sqlite3 and defmethod jdbc/spec-\u003edb-cast :sqlite3\n- REFACTOR: Ensure non-vector types still use defaults\n\nKey files: sqlite3.clj\nReference: postgres.clj lines 31-47 for how pgvector does this","status":"closed","priority":1,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:04.679182-07:00","created_by":"Micah","updated_at":"2026-02-11T11:53:53.065972-07:00","closed_at":"2026-02-11T11:53:53.065972-07:00","close_reason":"Closed","dependencies":[{"issue_id":"bucket-04m","depends_on_id":"bucket-c01","type":"blocks","created_at":"2026-02-11T11:40:17.921492-07:00","created_by":"Micah"}]}
{"id":"bucket-0uo","title":"KNN query generation for sqlite3 vectors","description":"Translate the bucket vector ORDER BY API into sqlite-vec scalar distance function calls.\n\nAPI: (find :vectorable :order-by {:embedding ['\u003c-\u003e [1.0 0.0 0.0]]} :take 2)\n\nMust generate SQL like:\n  SELECT * FROM vectorable ORDER BY vec_distance_L2(embedding, vec_f32(?)) LIMIT 2\n\nOperator mapping:\n- '\u003c-\u003e maps to vec_distance_L2\n- '\u003c=\u003e maps to vec_distance_cosine\n- '\u003c#\u003e NOT SUPPORTED on sqlite — throw exception\n\nThe schema :db :distance config (:l2 or :cosine) determines which operators are valid.\n\nTDD:\n- RED: find with '\u003c-\u003e returns entities ordered by L2 distance\n- RED: find with '\u003c=\u003e returns entities ordered by cosine distance\n- RED: find with :take limits results correctly\n- GREEN: Override build-order-clause behavior for :sqlite3 when vector operators are used\n- REFACTOR: Ensure non-vector ORDER BY still works\n\nKey files: sqlite3.clj, jdbc.clj (build-order-clause at line 453)\nReference: impl_spec.cljc lines 858-893 for shared vector specs","status":"closed","priority":1,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:26.565119-07:00","created_by":"Micah","updated_at":"2026-02-11T13:01:06.735807-07:00","closed_at":"2026-02-11T13:01:06.735807-07:00","close_reason":"Closed","dependencies":[{"issue_id":"bucket-0uo","depends_on_id":"bucket-c01","type":"blocks","created_at":"2026-02-11T11:40:18.053602-07:00","created_by":"Micah"},{"issue_id":"bucket-0uo","depends_on_id":"bucket-04m","type":"blocks","created_at":"2026-02-11T11:40:21.62817-07:00","created_by":"Micah"},{"issue_id":"bucket-0uo","depends_on_id":"bucket-eg9","type":"blocks","created_at":"2026-02-11T11:40:25.450571-07:00","created_by":"Micah"},{"issue_id":"bucket-0uo","depends_on_id":"bucket-t00","type":"blocks","created_at":"2026-02-11T11:40:25.492521-07:00","created_by":"Micah"}]}
{"id":"bucket-29b","title":"Migration support for sqlite3 vector columns","description":"Handle vector columns in schema migration: add-attribute, remove-attribute, and schema introspection.\n\nChallenges:\n- BLOB columns need to be recognized as vector columns during introspection\n- Adding a vector column = adding a BLOB column\n- Schema sync needs to handle vec_f32(N) type declarations\n\nTDD:\n- RED: add-attribute for a vector spec creates a BLOB column\n- RED: installed-schema-legend correctly identifies vector BLOB columns","status":"closed","priority":3,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:40:01.436529-07:00","created_by":"Micah","updated_at":"2026-02-11T15:26:55.393213-07:00","closed_at":"2026-02-11T15:26:55.393213-07:00","close_reason":"Closed"}
{"id":"bucket-45w","title":"Handle nil vector embeddings on sqlite3","description":"Ensure nil embeddings are handled gracefully on sqlite3, matching pgvector behavior.\n\npgvector behavior: nil embeddings sort last in distance-ordered queries.\n\nTDD:\n- RED: tx entity with nil embedding, then find with vector ORDER BY — nil entities sort last\n- GREEN: Handle nil in -\u003esql-value and query generation\n\nReference: impl_spec.cljc line 884 for pgvector nil test","status":"closed","priority":3,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:44.909732-07:00","created_by":"Micah","updated_at":"2026-02-11T15:20:38.871092-07:00","closed_at":"2026-02-11T15:20:38.871092-07:00","close_reason":"Closed"}
{"id":"bucket-6i1","title":"Mixed vector and non-vector ORDER BY on sqlite3","description":"Support ORDER BY clauses that combine vector distance with regular column ordering.\n\nExample: :order-by {:embedding ['\u003c-\u003e query-vec] :name :asc}\n\nTDD:\n- RED: Combined vector + scalar ORDER BY returns correct results\n- GREEN: Ensure build-order-clause handles mixed cases","status":"closed","priority":3,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:50.67373-07:00","created_by":"Micah","updated_at":"2026-02-11T15:22:16.969317-07:00","closed_at":"2026-02-11T15:22:16.969317-07:00","close_reason":"Closed"}
{"id":"bucket-8ii","title":"vec0 virtual table optimization path for sqlite3","description":"Future optimization: add support for sqlite-vec's vec0 virtual tables as an indexed KNN path.\n\nThe scalar distance function approach (vec_distance_L2 in ORDER BY) does brute-force full table scans. For large datasets, vec0 virtual tables provide indexed search.\n\nThis would require:\n- Shadow vec0 tables managed alongside entity tables\n- INSERT/UPDATE mirroring to vec0 tables\n- KNN queries via MATCH/k= syntax\n- JOIN back to entity tables for full results\n\nThis is an optimization over the baseline scalar approach and can be added later.","status":"open","priority":4,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:40:13.471289-07:00","created_by":"Micah","updated_at":"2026-02-11T11:40:13.471289-07:00"}
{"id":"bucket-c01","title":"SQLite extension loading mechanism","description":"Add :extensions config support to the sqlite3 dialect adapter. Post-connect, call SELECT load_extension(path) for each configured extension.\n\nTDD:\n- RED: Test that a sqlite3 db with :extensions ['/path/to/vec0'] config calls load_extension\n- RED: Test graceful error when extension path is invalid\n- GREEN: Implement post-connect hook in jdbc.clj connect function (dialect-specific multimethod)\n- REFACTOR: Clean up\n\nKey files: jdbc.clj (connect fn), sqlite3.clj\nReference: postgres_spec.clj line 52 for how pgvector extension is loaded via jdbc/execute!","status":"closed","priority":1,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:38:58.479569-07:00","created_by":"Micah","updated_at":"2026-02-11T11:49:46.350768-07:00","closed_at":"2026-02-11T11:49:46.350768-07:00","close_reason":"Closed"}
{"id":"bucket-eg9","title":"Vector serialization (write path) for sqlite3","description":"Implement writing vectors to SQLite as BLOBs via vec_f32().\n\nThree parts:\n1. DDL: vector columns become BLOB type in CREATE TABLE (strip dimension from vec_f32(3))\n2. -\u003esql-value: convert Clojure vector [1.0 0.0 0.0] to JSON string '[1.0,0.0,0.0]'\n3. -\u003esql-param: wrap with vec_f32(?) instead of plain ? for vector params\n\nTDD:\n- RED: CREATE TABLE generates BLOB column for vector spec\n- RED: -\u003esql-value :sqlite-vec [1.0 0.0 0.0] returns '[1.0,0.0,0.0]'\n- RED: -\u003esql-param for :sqlite-vec type returns 'vec_f32(?)'\n- GREEN: Implement in sqlite3.clj\n- REFACTOR: Clean up\n\nKey files: sqlite3.clj\nReference: postgres.clj lines 54-56 for pgvector -\u003esql-value","status":"closed","priority":1,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:11.204555-07:00","created_by":"Micah","updated_at":"2026-02-11T12:18:19.438275-07:00","closed_at":"2026-02-11T12:18:19.438275-07:00","close_reason":"Closed","dependencies":[{"issue_id":"bucket-eg9","depends_on_id":"bucket-c01","type":"blocks","created_at":"2026-02-11T11:40:17.968343-07:00","created_by":"Micah"},{"issue_id":"bucket-eg9","depends_on_id":"bucket-04m","type":"blocks","created_at":"2026-02-11T11:40:21.542951-07:00","created_by":"Micah"}]}
{"id":"bucket-k1l","title":"Operator-distance metric validation for sqlite3 vectors","description":"Validate at query time that the vector distance operator matches the schema's configured distance metric. Throw a clear exception on mismatch.\n\nRules:\n- Schema with :distance :l2 (default) — only '\u003c-\u003e is valid\n- Schema with :distance :cosine — only '\u003c=\u003e is valid\n- '\u003c#\u003e (inner product) is never valid on sqlite — always throw\n- Missing :distance defaults to :l2\n\nTDD:\n- RED: '\u003c=\u003e on a :distance :l2 schema throws with clear message\n- RED: '\u003c-\u003e on a :distance :cosine schema throws with clear message\n- RED: '\u003c#\u003e always throws on sqlite3\n- RED: correct operator on matching schema succeeds\n- GREEN: Add validation in the sqlite3 order-by code path\n- REFACTOR: Clean up error messages\n\nKey files: sqlite3.clj","status":"closed","priority":2,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:33.121934-07:00","created_by":"Micah","updated_at":"2026-02-11T13:07:22.626783-07:00","closed_at":"2026-02-11T13:07:22.626783-07:00","close_reason":"Closed","dependencies":[{"issue_id":"bucket-k1l","depends_on_id":"bucket-c01","type":"blocks","created_at":"2026-02-11T11:40:18.095288-07:00","created_by":"Micah"},{"issue_id":"bucket-k1l","depends_on_id":"bucket-0uo","type":"blocks","created_at":"2026-02-11T11:40:25.534784-07:00","created_by":"Micah"}]}
{"id":"bucket-kfk","title":"Graceful error when sqlite-vec extension is missing","description":"When a schema declares vector columns but the sqlite-vec extension is not loaded (or the extension path is wrong), provide a clear error message rather than cryptic SQL failures.\n\nTDD:\n- RED: Attempting vector operations without extension loaded gives helpful error\n- GREEN: Detect and wrap extension-related errors","status":"open","priority":3,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:40:06.435495-07:00","created_by":"Micah","updated_at":"2026-02-11T11:40:06.435495-07:00"}
{"id":"bucket-mih","title":"Multiple vector columns on same sqlite3 entity","description":"Support entities with more than one vector column (e.g., title_embedding and body_embedding).\n\nEach may have different dimensions and distance metrics.\n\nTDD:\n- RED: Entity with two vector columns stores and retrieves both correctly\n- RED: Can ORDER BY either vector column independently","status":"closed","priority":3,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:55.685765-07:00","created_by":"Micah","updated_at":"2026-02-11T15:23:31.730928-07:00","closed_at":"2026-02-11T15:23:31.730928-07:00","close_reason":"Closed"}
{"id":"bucket-t00","title":"Vector deserialization (read path) for sqlite3","description":"Implement reading vectors back from SQLite BLOBs into Clojure vectors of doubles.\n\nsqlite-vec stores vectors as binary BLOBs (packed float32 arrays). Need to decode these back to Clojure vectors.\n\nTDD:\n- RED: Roundtrip test — tx a vectorable entity with [1.0 0.0 0.0], read it back, verify vector equality\n- RED: vec_to_json or direct BLOB decode returns correct Clojure vector\n- GREEN: Implement \u003c-sql-value-for-dialect :sqlite3 for :sqlite-vec type\n- REFACTOR: Clean up\n\nKey files: sqlite3.clj\nReference: postgres.clj lines 17-24 and 49-52 for pgvector read path","status":"closed","priority":1,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:17.627434-07:00","created_by":"Micah","updated_at":"2026-02-11T12:45:44.435122-07:00","closed_at":"2026-02-11T12:45:44.435122-07:00","close_reason":"Closed","dependencies":[{"issue_id":"bucket-t00","depends_on_id":"bucket-c01","type":"blocks","created_at":"2026-02-11T11:40:18.011168-07:00","created_by":"Micah"},{"issue_id":"bucket-t00","depends_on_id":"bucket-04m","type":"blocks","created_at":"2026-02-11T11:40:21.586869-07:00","created_by":"Micah"},{"issue_id":"bucket-t00","depends_on_id":"bucket-eg9","type":"blocks","created_at":"2026-02-11T11:40:25.40551-07:00","created_by":"Micah"}]}
{"id":"bucket-t2o","title":"Clear and delete with vector columns on sqlite3","description":"Verify that clear, delete-all, and entity deletion work correctly on entities that have vector BLOB columns.\n\nSince vectors are stored as regular BLOB columns (not virtual tables), this should work without special handling. But we need tests to prove it.\n\nTDD:\n- RED: clear on vectorable entities works (table recreated, vector_init may need re-calling)\n- RED: delete-all on vectorable kind works\n- RED: deleting a single vectorable entity works\n- GREEN: Fix any issues found\n- REFACTOR: Clean up\n\nKey files: sqlite3.clj, sqlite3_spec.clj","status":"closed","priority":2,"issue_type":"task","owner":"micahmartin@gmail.com","created_at":"2026-02-11T11:39:38.984851-07:00","created_by":"Micah","updated_at":"2026-02-11T15:15:40.381583-07:00","closed_at":"2026-02-11T15:15:40.381583-07:00","close_reason":"Closed","dependencies":[{"issue_id":"bucket-t2o","depends_on_id":"bucket-c01","type":"blocks","created_at":"2026-02-11T11:40:18.136762-07:00","created_by":"Micah"},{"issue_id":"bucket-t2o","depends_on_id":"bucket-eg9","type":"blocks","created_at":"2026-02-11T11:40:28.812841-07:00","created_by":"Micah"},{"issue_id":"bucket-t2o","depends_on_id":"bucket-t00","type":"blocks","created_at":"2026-02-11T11:40:28.856097-07:00","created_by":"Micah"}]}
